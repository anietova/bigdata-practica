#pip install flask boto3

from flask import Flask, jsonify, render_template
import boto3
from decimal import Decimal

app = Flask(__name__)

# Cliente acceso a dynamo
dynamodb = boto3.resource('dynamodb', region_name='us-east-1')
table = dynamodb.Table('trades')

# Convierte Decimal a float para JSON
def dec_to_float(item):
    for k, v in item.items():
        if isinstance(v, Decimal):
            item[k] = float(v)
    return item

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/data')
def get_data():
    # Leemos los Ãºltimos 20 registros
    response = table.scan(Limit=20)
    items = [dec_to_float(i) for i in response['Items']]
    return jsonify(items)

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)

